
def shakehand():
  rest()
  inMoov.startedGesture()
  ##move arm and hand
  inMoov.setHandVelocity("left", 22.0, 22.0, 22.0, 22.0, 22.0, -1)
  inMoov.setHandVelocity("right", 22.0, 22.0, 22.0, 22.0, 22.0, -1)
  inMoov.setArmVelocity("right", 31.0, 43.0, 59, 43.0)
  inMoov.setArmVelocity("left", 31.0, 43.0, 59, 43.0)
  inMoov.setHeadVelocity(-1, -1)
  inMoov.setTorsoVelocity(31.0, 13.0, -1)
  inMoov.moveHead(39,70)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,55,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",50,50,40,20,20,90)
  inMoov.moveTorso(95,95,90)
  sleep(3)
  ##set hand up
  inMoov.setHandVelocity("left", 22.0, 22.0, 22.0, 22.0, 22.0, -1)
  inMoov.setHandVelocity("right", 43.0, 43.0, 43.0, 43.0, 43.0, -1)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(-1, -1)
  inMoov.setTorsoVelocity(31.0, 13.0, -1)
  inMoov.moveHead(90,90)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,60,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveTorso(95,95,90)
  inMoov.moveHand("right",80,70,70,50,50,77)
  ##ask chatbot to say something
  chatBot.getResponse("SYSTEM_SHAKE_HAND_GET_CLOSER")
   ##optional, detect if there is a human ( waiting finger sensor, we use ultrasonic distance as test )
  if ultraSonicSensorActivated:
    distance=200
    timeout=0
    timeoutGetCloser=0
    while (not distance or distance > 100): 
      timeout+=1
      timeoutGetCloser+=1
      distance=inMoov.getUltrasonicSensorDistance()
      print distance
      if timeout > 20:
        chatBot.getResponse("SYSTEM_SHAKE_HAND_NOHUMAN")
        sleep(2)
        shakehandFinish()
        break
      # ask GET CLOSER
      if timeoutGetCloser>6:
        chatBot.getResponse("SYSTEM_SHAKE_HAND_GET_CLOSER")
        timeoutGetCloser=0
        sleep(2)
      sleep(0.5)
      # great, human detected
    if distance<=100:shakehandAnimation()
  else:
    sleep(3)
    shakehandAnimation()

def shakehandAnimation():
  chatBot.getResponse("SYSTEM_SHAKE_HAND")
  ##close the hand
  inMoov.moveHand("right",180,125,135,145,168,77)
  sleep(1)
  inMoov.setHandVelocity("left", 22.0, 22.0, 22.0, 22.0, 22.0, -1)
  inMoov.setHandVelocity("right", 43.0, 43.0, 43.0, 43.0, 43.0, -1)
  inMoov.setArmVelocity("right", 31.0, 43.0, 59, 43.0)
  inMoov.setArmVelocity("left", 31.0, 43.0, 31.0, 43.0)
  inMoov.setHeadVelocity(-1, -1)
  inMoov.setTorsoVelocity(31.0, 13.0, -1)
  inMoov.moveHead(39,70)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,48,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(3)
  inMoov.setHandVelocity("left", -1, -1, -1, -1, -1, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(31.0, 31.0)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(70,53)
  sleep(0.5)
  inMoov.moveHead(39,70)
  sleep(0.5)
  inMoov.moveHead(70,53)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,48,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(1.5)
  ##shake hand up
  inMoov.setHandVelocity("left", -1, -1, -1, -1, -1, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(43.0, 43.0)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(80,53)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,60,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(1)
  ##shake hand down
  inMoov.setHandVelocity("left", -1, -1, -1, -1, -1, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(43.0, 43.0)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(80,88)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,48,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(1.5)
  ##shake hand up
  inMoov.setHandVelocity("left", -1, -1, -1, -1, -1, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(43.0, 43.0)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(80,53)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,60,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(1)
  ##shake hand down
  inMoov.setHandVelocity("left", -1, -1, -1, -1, -1, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("left", -1.0, -1.0, -1.0, -1.0)
  inMoov.setArmVelocity("right", -1.0, -1.0, -1.0, -1.0)
  inMoov.setHeadVelocity(43.0, 43.0)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(80,88)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,48,16)
  inMoov.moveHand("left",50,50,40,20,20,90)
  inMoov.moveHand("right",180,125,135,145,168,77)
  inMoov.moveTorso(95,95,90)
  sleep(1.5)
  ## release hand  
  inMoov.setHandVelocity("left", 22.0, 22.0, 22.0, 22.0, 22.0, -1)
  inMoov.setHandVelocity("right", -1, -1, -1, -1, -1, -1)
  inMoov.setArmVelocity("right", 59, 59, 59, 43.0)
  inMoov.setArmVelocity("left", 31.0, 43.0, 59, 43.0)
  inMoov.setHeadVelocity(-1, -1)
  inMoov.setTorsoVelocity(22.0, 13.0, -1)
  inMoov.moveHead(39,70)
  inMoov.moveArm("left",5,84,16,15)
  inMoov.moveArm("right",6,73,45,16)
  inMoov.moveHand("left",50,50,40,20,20,77)
  inMoov.moveHand("right",20,30,30,20,20,90)
  inMoov.moveTorso(95,95,90)
  sleep(1)
  shakehandFinish()

def shakehandFinish():
  inMoov.finishedGesture()
  rest()
  relax()